{% extends 'base.html' %}

{% block title %}Shorts{% endblock %}

{% block content %}
<form id="uploadForm">
    {% csrf_token %}
    {{ form }}
    <button type="button" onclick="uploadFile()">Upload Video</button>
</form>
<progress id="progressBar" value="0" max="100" style="width: 100%; display: none;"></progress>
<div id="progressText"></div>

<script>
    function uploadFile() {
        const form = document.getElementById("uploadForm");
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");

        const formData = new FormData(form);
        const xhr = new XMLHttpRequest();

        // Show progress bar
        progressBar.style.display = "block";

        // Update progress bar on progress event
        xhr.upload.addEventListener("progress", (event) => {
            if (event.lengthComputable) {
                const percentComplete = (event.loaded / event.total) * 100;
                progressBar.value = percentComplete;
                progressText.textContent = `Uploading: ${Math.round(percentComplete)}%`;
            }
        });

        // Handle upload completion
        xhr.addEventListener("load", () => {
            progressText.textContent = "Upload complete!";
            progressBar.value = 100;
        });

        // Handle upload errors
        xhr.addEventListener("error", () => {
            progressText.textContent = "Upload failed. Please try again.";
        });

        // Configure and send the request
        xhr.open("POST", "{% url 'index' %}");
        xhr.send(formData);
    }
</script>
{% endblock %}